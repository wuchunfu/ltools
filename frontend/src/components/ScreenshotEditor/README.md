# æˆªå›¾ç¼–è¾‘å™¨ä¸‰å±‚æ¶æ„

## ğŸ“ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ScreenshotEditorLayers                â”‚
â”‚                  (ä¸»åè°ƒç»„ä»¶)                            â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å·¥å…·å±‚ (ToolbarLayer) - z-index: 10002         â”‚  â”‚
â”‚  â”‚  âœ“ ç¡®è®¤  âœ• å–æ¶ˆ  |  åŒå‡»æˆ– Enter ç¡®è®¤...       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  äº¤äº’å±‚ (InteractionLayer) - z-index: 10001     â”‚  â”‚
â”‚  â”‚  â€¢ å¤„ç†é¼ æ ‡äº‹ä»¶                                  â”‚  â”‚
â”‚  â”‚  â€¢ ç»˜åˆ¶é€‰æ‹©æ¡†                                    â”‚  â”‚
â”‚  â”‚  â€¢ è®¡ç®—é€‰æ‹©åŒºåŸŸ                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é®ç½©å±‚ (MaskLayer) - z-index: 10000            â”‚  â”‚
â”‚  â”‚  â€¢ æ¸²æŸ“åŸå§‹æˆªå›¾                                  â”‚  â”‚
â”‚  â”‚  â€¢ ç»˜åˆ¶åŠé€æ˜é®ç½©                                â”‚  â”‚
â”‚  â”‚  â€¢ æ¸…é™¤é€‰ä¸­åŒºåŸŸé®ç½©                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ä¸‰å±‚èŒè´£

### 1. é®ç½©å±‚ (MaskLayer) - z-index: 10000

**èŒè´£ï¼š**
- âœ… åŠ è½½å¹¶æ¸²æŸ“åŸå§‹æˆªå›¾
- âœ… ç»˜åˆ¶åŠé€æ˜é»‘è‰²é®ç½© (rgba(0, 0, 0, 0.3))
- âœ… æ¸…é™¤é€‰ä¸­åŒºåŸŸçš„é®ç½©ï¼Œä¿æŒæ¸…æ™°
- âœ… ä¸å¤„ç†ä»»ä½•ç”¨æˆ·äº‹ä»¶

**ç‰¹ç‚¹ï¼š**
- çº¯è§†è§‰å±‚ï¼Œä½¿ç”¨ `pointer-events: none`
- é€šè¿‡ `canvasRef` ä¸çˆ¶ç»„ä»¶é€šä¿¡
- ç‹¬ç«‹çš„æ¸²æŸ“é€»è¾‘

### 2. äº¤äº’å±‚ (InteractionLayer) - z-index: 10001

**èŒè´£ï¼š**
- âœ… ç›‘å¬æ‰€æœ‰é¼ æ ‡/è§¦æ‘¸äº‹ä»¶
- âœ… è®¡ç®—é€‰æ‹©åŒºåŸŸçš„åæ ‡å’Œå°ºå¯¸
- âœ… ç»˜åˆ¶é€‰æ‹©è¾¹æ¡†ï¼ˆç»¿è‰²è¾¹æ¡† #4CD964ï¼‰
- âœ… æ˜¾ç¤ºé€‰æ‹©åŒºåŸŸå°ºå¯¸
- âœ… å¤„ç†åŒå‡»ç¡®è®¤

**ç‰¹ç‚¹ï¼š**
- å®Œå…¨äº‹ä»¶å¤„ç†å±‚
- å®æ—¶å“åº”ç”¨æˆ·æ“ä½œ
- é€šè¿‡å›è°ƒå‡½æ•°ä¸çˆ¶ç»„ä»¶é€šä¿¡

### 3. å·¥å…·å±‚ (ToolbarLayer) - z-index: 10002

**èŒè´£ï¼š**
- âœ… æ˜¾ç¤ºç¡®è®¤/å–æ¶ˆæŒ‰é’®
- âœ… æ˜¾ç¤ºæ“ä½œæç¤ºä¿¡æ¯
- âœ… æ¡ä»¶æ¸²æŸ“ï¼ˆä»…åœ¨æœ‰é€‰æ‹©æ—¶æ˜¾ç¤ºï¼‰
- âœ… å¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶

**ç‰¹ç‚¹ï¼š**
- æœ€ä¸Šå±‚ï¼Œz-index æœ€é«˜
- å®¹å™¨ä½¿ç”¨ `pointer-events: none`
- æŒ‰é’®ä½¿ç”¨ `pointer-events: auto`

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ç”¨æ³•

```tsx
import { ScreenshotEditorLayers } from '@/components/ScreenshotEditor';

function App() {
  const handleSelectionComplete = (imageData: string, bounds: Bounds) => {
    console.log('é€‰æ‹©çš„åŒºåŸŸ:', bounds);
    console.log('æˆªå›¾æ•°æ®:', imageData);
    // ä¿å­˜æˆ–è¿›ä¸€æ­¥å¤„ç†
  };

  const handleCancel = () => {
    console.log('ç”¨æˆ·å–æ¶ˆæˆªå›¾');
  };

  return (
    <ScreenshotEditorLayers
      imageData="data:image/png;base64,..."
      onSelectionComplete={handleSelectionComplete}
      onCancel={handleCancel}
    />
  );
}
```

### é«˜çº§ç”¨æ³• - è‡ªå®šä¹‰å·¥å…·å±‚

```tsx
import { MaskLayer, InteractionLayer } from '@/components/ScreenshotEditor';

function CustomScreenshotEditor() {
  const [selection, setSelection] = useState<SelectionRect>({ x: 0, y: 0, width: 0, height: 0 });

  return (
    <>
      <MaskLayer imageSrc={...} selection={selection} canvasRef={...} />
      <InteractionLayer
        enabled={true}
        onSelectionComplete={setSelection}
        onDoubleClick={() => console.log('ç¡®è®¤')}
      />
      {/* è‡ªå®šä¹‰å·¥å…·å±‚ */}
      <div className="custom-toolbar">
        <button>ä¿å­˜</button>
        <button>å¤åˆ¶</button>
        <button>æ ‡æ³¨</button>
      </div>
    </>
  );
}
```

## ğŸ”§ æ‰©å±•æ€§

### æ·»åŠ æ–°çš„æ ‡æ³¨å·¥å…·

ç”±äºä¸‰å±‚åˆ†ç¦»ï¼Œå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ ‡æ³¨åŠŸèƒ½ï¼š

```tsx
// åœ¨äº¤äº’å±‚ä¹‹ä¸Šæ·»åŠ æ ‡æ³¨å±‚
<AnnotationLayer
  visible={hasAnnotation}
  tools={['rect', 'arrow', 'text']}
  currentTool={currentTool}
  onAnnotationAdd={handleAnnotationAdd}
/>
```

### æ”¯æŒå¤šç‚¹è§¦æ§

```tsx
// åœ¨äº¤äº’å±‚æ·»åŠ è§¦æ‘¸æ”¯æŒ
<InteractionLayer
  enabled={true}
  touchEnabled={true}
  onPinchZoom={handleZoom}
  onTwoFingerPan={handlePan}
/>
```

## ğŸ¨ æ ·å¼å®šåˆ¶

### ä¿®æ”¹é®ç½©é¢œè‰²

```css
/* MaskLayer.css */
.mask-canvas {
  /* ä¿®æ”¹é®ç½©é€æ˜åº¦ */
  mask-image: linear-gradient(rgba(0, 0, 0, 0.5));
}
```

### ä¿®æ”¹é€‰æ‹©æ¡†æ ·å¼

```tsx
// InteractionLayer.tsx
ctx.strokeStyle = '#FF6B6B'; // æ”¹ä¸ºçº¢è‰²
ctx.lineWidth = 3; // åŠ ç²—è¾¹æ¡†
```

### ä¿®æ”¹å·¥å…·æ æ ·å¼

```css
/* ToolbarLayer.css */
.toolbar-button-confirm {
  background: rgba(59, 130, 246, 0.9); /* è“è‰² */
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ä½¿ç”¨ React.memo ä¼˜åŒ–

```tsx
export const MaskLayer = React.memo<MaskLayerProps>(({ imageSrc, selection, canvasRef }) => {
  // ç»„ä»¶å®ç°
}, (prevProps, nextProps) => {
  // ä»…å½“ selection å˜åŒ–æ—¶é‡æ–°æ¸²æŸ“
  return prevProps.selection === nextProps.selection;
});
```

### ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–ç»˜åˆ¶

```tsx
const drawSelection = useCallback(() => {
  requestAnimationFrame(() => {
    // ç»˜åˆ¶é€»è¾‘
  });
}, [selection]);
```

## ğŸ› è°ƒè¯•æŠ€å·§

### æ˜¾ç¤ºå±‚çº§è¾¹ç•Œ

```css
/* å¼€å‘æ—¶æ·»åŠ è¾¹æ¡† */
.mask-canvas { outline: 2px solid red; }
.interaction-canvas { outline: 2px solid green; }
.toolbar-layer { outline: 2px solid blue; }
```

### è®°å½•äº‹ä»¶

```tsx
<InteractionLayer
  onSelectionChange={(sel) => console.log('é€‰æ‹©å˜åŒ–:', sel)}
  onSelectionComplete={(sel) => console.log('é€‰æ‹©å®Œæˆ:', sel)}
/>
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Canvas å°ºå¯¸åŒæ­¥**: ç¡®ä¿é®ç½©å±‚å’Œäº¤äº’å±‚çš„ canvas å°ºå¯¸ä¸€è‡´
2. **äº‹ä»¶ç©¿é€**: é®ç½©å±‚å¿…é¡»è®¾ç½® `pointer-events: none`
3. **z-index ç®¡ç†**: ä¿æŒä¸‰å±‚æ­£ç¡®çš„ z-index å±‚çº§
4. **å†…å­˜æ¸…ç†**: ç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨
5. **åæ ‡è½¬æ¢**: æ³¨æ„ canvas åæ ‡å’Œå±å¹•åæ ‡çš„è½¬æ¢

## ğŸš€ æœªæ¥æ‰©å±•

- [ ] æ”¯æŒå¤šæ˜¾ç¤ºå™¨æˆªå›¾
- [ ] æ·»åŠ æ»šåŠ¨æˆªå›¾åŠŸèƒ½
- [ ] æ”¯æŒè§†é¢‘æˆªå›¾
- [ ] æ·»åŠ  OCR æ–‡å­—è¯†åˆ«
- [ ] æ”¯æŒäº‘ç«¯ä¿å­˜
- [ ] æ·»åŠ å†å²è®°å½•åŠŸèƒ½
