<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”®ç›˜äº‹ä»¶æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .event-log {
            background: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            padding: 2px 0;
            border-bottom: 1px solid #eee;
        }
        .log-escape {
            color: red;
            font-weight: bold;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007AFF;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0051D5;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”‘ é”®ç›˜äº‹ä»¶æµ‹è¯•é¡µé¢</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•é”®ç›˜äº‹ä»¶æ˜¯å¦èƒ½å¤Ÿè¢«æ­£ç¡®æ•è·ã€‚</p>

        <div>
            <button onclick="requestFocus()">è¯·æ±‚ç„¦ç‚¹</button>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="event-log" id="eventLog">
            <div class="log-entry">ç­‰å¾…é”®ç›˜äº‹ä»¶...</div>
        </div>

        <div style="margin-top: 20px;">
            <h3>æµ‹è¯•è¯´æ˜ï¼š</h3>
            <ul>
                <li>æŒ‰ä»»æ„é”®æŸ¥çœ‹äº‹ä»¶æ—¥å¿—</li>
                <li>æŒ‰ ESC é”®åº”è¯¥æ˜¾ç¤ºçº¢è‰²é«˜äº®</li>
                <li>ç‚¹å‡»"è¯·æ±‚ç„¦ç‚¹"æŒ‰é’®ç¡®ä¿é¡µé¢è·å¾—ç„¦ç‚¹</li>
            </ul>
        </div>
    </div>

    <script>
        const eventLog = document.getElementById('eventLog');
        let eventCount = 0;

        function addLog(message, isEscape = false) {
            eventCount++;
            const entry = document.createElement('div');
            entry.className = 'log-entry' + (isEscape ? ' log-escape' : '');
            entry.textContent = `${eventCount}. ${new Date().toLocaleTimeString()} - ${message}`;
            eventLog.appendChild(entry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        function clearLog() {
            eventLog.innerHTML = '<div class="log-entry">æ—¥å¿—å·²æ¸…ç©º</div>';
            eventCount = 0;
        }

        function requestFocus() {
            window.focus();
            addLog('å·²è¯·æ±‚çª—å£ç„¦ç‚¹');
        }

        // æµ‹è¯•ä¸åŒçš„äº‹ä»¶ç›‘å¬æ–¹å¼
        document.addEventListener('DOMContentLoaded', () => {
            addLog('é¡µé¢åŠ è½½å®Œæˆ');

            // æ–¹å¼1: æ™®é€šæ¨¡å¼
            window.addEventListener('keydown', (e) => {
                addLog(`[æ™®é€šæ¨¡å¼] æŒ‰é”®: ${e.key}, ä»£ç : ${e.code}`, e.key === 'Escape');
            });

            // æ–¹å¼2: æ•è·æ¨¡å¼
            window.addEventListener('keydown', (e) => {
                addLog(`[æ•è·æ¨¡å¼] æŒ‰é”®: ${e.key}, ä»£ç : ${e.code}`, e.key === 'Escape');
            }, { capture: true });

            // æ–¹å¼3: æ–‡æ¡£çº§åˆ«
            document.addEventListener('keydown', (e) => {
                addLog(`[æ–‡æ¡£çº§åˆ«] æŒ‰é”®: ${e.key}, ä»£ç : ${e.code}`, e.key === 'Escape');
            });

            // è¯·æ±‚ç„¦ç‚¹
            window.focus();
            addLog('å·²è‡ªåŠ¨è¯·æ±‚çª—å£ç„¦ç‚¹');

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶æ¥è¯·æ±‚ç„¦ç‚¹
            document.addEventListener('click', () => {
                window.focus();
                addLog('ç‚¹å‡»æ—¶è¯·æ±‚ç„¦ç‚¹');
            });
        });

        // é˜²æ­¢é¡µé¢ç¼“å­˜
        window.addEventListener('load', () => {
            addLog('çª—å£å®Œå…¨åŠ è½½');
        });
    </script>
</body>
</html>
