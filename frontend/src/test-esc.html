<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESC é”®æµ‹è¯• - ç‹¬ç«‹çª—å£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }
        .status {
            font-size: 24px;
            margin: 20px 0;
        }
        .success {
            color: #4CD964;
        }
        .waiting {
            color: #FFCC00;
        }
        .instructions {
            font-size: 18px;
            margin-top: 30px;
            opacity: 0.8;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            text-align: left;
            max-width: 400px;
        }
        .log-entry {
            margin: 5px 0;
        }
        .escape-detected {
            color: #FF3B30;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ¯ ESC é”®æµ‹è¯•</h1>
        <div class="status waiting" id="status">ç­‰å¾…æŒ‰é”®...</div>
        <div class="instructions">
            <p>æŒ‰ ESC é”®æµ‹è¯•äº‹ä»¶æ•è·</p>
            <p>å¦‚æœæ£€æµ‹åˆ° ESC é”®ï¼ŒçŠ¶æ€ä¼šå˜ä¸ºç»¿è‰²</p>
        </div>
        <div class="log" id="log">
            <div class="log-entry">é¡µé¢å·²åŠ è½½</div>
            <div class="log-entry">ç­‰å¾…é”®ç›˜äº‹ä»¶...</div>
        </div>
    </div>

    <script>
        const status = document.getElementById('status');
        const log = document.getElementById('log');
        let escapeDetected = false;

        function addLog(message, isEscape = false) {
            const entry = document.createElement('div');
            entry.className = 'log-entry' + (isEscape ? ' escape-detected' : '');
            entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            log.appendChild(entry);

            // ä¿æŒæœ€å¤š 10 æ¡æ—¥å¿—
            while (log.children.length > 10) {
                log.removeChild(log.firstChild);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è¯·æ±‚ç„¦ç‚¹
        window.addEventListener('load', () => {
            addLog('çª—å£å®Œå…¨åŠ è½½');
            window.focus();
            addLog('å·²è¯·æ±‚çª—å£ç„¦ç‚¹');

            // è®¾ç½®é¡µé¢æ ‡é¢˜
            document.title = 'ESC é”®æµ‹è¯• - æŒ‰ ESC å…³é—­';
        });

        // ç‚¹å‡»æ—¶è¯·æ±‚ç„¦ç‚¹
        document.addEventListener('click', () => {
            window.focus();
            addLog('ç‚¹å‡»æ—¶è¯·æ±‚ç„¦ç‚¹');
        });

        // æµ‹è¯•å¤šç§äº‹ä»¶ç›‘å¬æ–¹å¼
        // æ–¹å¼1: æ™®é€šæ¨¡å¼
        window.addEventListener('keydown', (e) => {
            addLog(`[æ™®é€š] æŒ‰é”®: ${e.key}`, e.key === 'Escape');
            if (e.key === 'Escape' && !escapeDetected) {
                escapeDetected = true;
                status.textContent = 'âœ“ ESC é”®æ£€æµ‹æˆåŠŸï¼';
                status.className = 'status success';
                setTimeout(() => {
                    if (confirm('ESC é”®æ£€æµ‹æˆåŠŸï¼æ˜¯å¦å…³é—­æµ‹è¯•çª—å£ï¼Ÿ')) {
                        window.close();
                    }
                }, 500);
            }
        });

        // æ–¹å¼2: æ•è·æ¨¡å¼
        window.addEventListener('keydown', (e) => {
            addLog(`[æ•è·] æŒ‰é”®: ${e.key}`, e.key === 'Escape');
        }, { capture: true });

        // æ–¹å¼3: æ–‡æ¡£çº§åˆ«
        document.addEventListener('keydown', (e) => {
            addLog(`[æ–‡æ¡£] æŒ‰é”®: ${e.key}`, e.key === 'Escape');
        });

        // é˜²æ­¢å³é”®èœå•å¹²æ‰°
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        addLog('é”®ç›˜ç›‘å¬å™¨å·²è®¾ç½®');
    </script>
</body>
</html>
