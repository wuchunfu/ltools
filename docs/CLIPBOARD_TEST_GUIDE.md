# 剪贴板自动监控功能测试指南

## 功能说明

剪贴板管理器插件现在支持**自动监控**系统剪贴板变化。当您复制任何内容时，它会自动添加到剪贴板历史记录中。

## 技术实现

### 后端 (Go)
- **监控机制**: 每 500ms 轮询一次系统剪贴板
- **检测方法**: 使用 `osascript` 在 macOS 上读取剪贴板内容
- **事件触发**: 检测到变化后自动调用 `AddToHistory()` 并发出 `clipboard:new` 事件

### 前端 (React)
- **事件监听**: 监听 `clipboard:new`、`clipboard:cleared`、`clipboard:count` 事件
- **自动更新**: 收到事件后自动刷新历史记录列表
- **UI 反馈**: 显示剪贴板项目总数、支持搜索、复制、删除操作

## 验证步骤

### 1. 启动应用
```bash
cd /Users/yanglian/code/ltools
task dev
```

### 2. 在浏览器中打开应用
```
http://localhost:9245
```

### 3. 导航到剪贴板管理器
- 点击左侧菜单的 "剪贴板管理器" 图标
- 应该看到剪贴板历史记录列表

### 4. 测试自动监控

**测试 1: 复制短文本**
```
复制任何文本，例如: test-123
等待 1-2 秒
检查历史记录是否自动更新
```

**测试 2: 复制长文本**
```
复制一段长文本
检查是否正确截断显示
```

**测试 3: 复制特殊字符**
```
复制包含特殊字符的文本: !@#$%^&*()
检查是否正确保存
```

**测试 4: 复制多行文本**
```
复制多行文本
检查是否正确保存换行符
```

### 5. 测试功能

**搜索功能**
```
在搜索框中输入关键词
点击 "搜索" 按钮
查看过滤结果
```

**复制功能**
```
点击历史记录项的 "复制" 按钮
检查是否显示 "已复制" 状态
```

**删除功能**
```
点击历史记录项的 "删除" 按钮
检查项目是否被移除
```

**清空历史**
```
点击 "清空历史" 按钮
确认对话框
检查所有历史记录是否被清空
```

## 调试信息

### 后端日志
应用运行时会输出以下调试信息：
```
[Clipboard Plugin] Monitor started, checking every 500ms
[Clipboard Plugin] Read clipboard: "..." (XX chars)
[Clipboard Plugin] Clipboard changed! New content length: XX
[Clipboard Plugin] Added to history: "..." (total: X items)
```

### 检查插件状态
配置文件位置: `~/Library/Application Support/ltools/plugins.json`

剪贴板插件应该显示为:
```json
{
  "state": "enabled"
}
```

## 已知问题

1. **启动延迟**: 应用启动后可能需要 1-2 秒才开始监控
2. **轮询间隔**: 当前设置为 500ms，可能错过快速连续的复制操作
3. **平台限制**: 当前仅支持 macOS，使用 `osascript` 读取剪贴板

## 下一步改进

1. **减少轮询间隔**: 可以考虑调整到 250ms 或更短
2. **跨平台支持**: 添加 Windows 和 Linux 的剪贴板读取方法
3. **持久化存储**: 将历史记录保存到文件，应用重启后恢复
4. **去重功能**: 避免重复添加相同内容
5. **图像支持**: 支持剪贴板图像内容

## 快速测试脚本

运行测试脚本:
```bash
/Users/yanglian/code/ltools/test_clipboard.sh
```

此脚本会自动复制 4 种不同类型的文本到剪贴板，用于验证监控功能。
